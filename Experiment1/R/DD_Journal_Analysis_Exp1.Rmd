---
title: 'Experiment 1: Drag-and-drop Analysis for Journal Paper'
output:
  html_document:
    df_print: paged
---

This is an [R Markdown] Notebook that analyzes of Experiment 1 (MTurk).
merged_exp_1_v3_fred.csv file is generated by Fred Yan based on the log files.
DD_Exp1_Sequence_Strategy_pretest_01182019.csv file (strategies) is generated by Yang and modified by Tao based on the merged_exp_1_v3_fred.csv. 
Exp1_D_D_Scores.csv file is based on C4 data provided by Pavan.
Exp1_demographics.csv file is based on MTurk data provided by Heather.

```{r}
# set current working directory. 
# the current working directory should include folder merge storing merged data 
# for the extraction and analysis of process data
setwd("C://Users/yjiang002/OneDrive - Educational Testing Service/NAEP/2018 Science Pilot/2018 ICT rawdata/code/Processing")
source("./GeneralFunc.r") # incorporate functions from GeneralFunc.r

# set current working directory to store output. 
setwd("C://Users/yjiang002/OneDrive - Educational Testing Service/NAEP/2018 Science Pilot/2018 ICT rawdata")

```

# Read and analyze extracted process data

```{r}
# read back data files
scene1 <- "ErosionControl"; k1 <- "K1876MS"
file1 <- file.path(direct, paste("ProcData_", scene1, "_", k1, ".csv", sep=""))
ErosionControlDF <- read.csv(file1)
scene2 <- "ControlVariable"; k2 <- "K1877MS"
file2 <- file.path(direct, paste("ProcData_", scene2, "_", k2, ".csv", sep=""))
ControlVariableDF <- read.csv(file2)
scene3 <- "Construction"; k3 <- "K187501"
file3 <- file.path(direct, paste("ProcData_", scene3, "_", k3, ".csv", sep=""))
ConstructionDF <- read.csv(file3)
scene4 <- "SampleData"; k4a <- "K187302"; k4b <- "K187402"
file4a <- file.path(direct, paste("ProcData_", scene4, "_", k4a, ".csv", sep=""))
SampleDataDFa <- read.csv(file4a)
file4b <- file.path(direct, paste("ProcData_", scene4, "_", k4b, ".csv", sep=""))
SampleDataDFb <- read.csv(file4b)
scene5 <- "DataCompare"; k5a <- "K187801"; k5b <- "K1879MS"
file5a <- file.path(direct, paste("ProcData_", scene5, "_", k5a, ".csv", sep=""))
DataCompareDFa <- read.csv(file5a)
file5b <- file.path(direct, paste("ProcData_", scene5, "_", k5b, ".csv", sep=""))
DataCompareDFb <- read.csv(file5b)
scene6 <- "FinalItems"; k6a <- "K188001"; k6b <- "K188101"
file6a <- file.path(direct, paste("ProcData_", scene6, "_", k6a, ".csv", sep=""))
FinalItemsDFa <- read.csv(file6a)
file6b <- file.path(direct, paste("ProcData_", scene6, "_", k6b, ".csv", sep=""))
FinalItemsDFb <- read.csv(file6b)
scene7 <- "Introduction"; k7 <- "K1871MS"
file7 <- file.path(direct, paste("ProcData_", scene7, "_", k7, ".csv", sep=""))
IntroductionDF <- read.csv(file7)
scene8 <- "LocationXDepth"; k8 <- "K1872MS"
file8 <- file.path(direct, paste("ProcData_", scene8, "_", k8, ".csv", sep=""))
LocationXDepthDF <- read.csv(file8)
```

# Fair Test Results

## Figure 23. Percentage of students in each strategy group (scoring group).
Res_ErosionControl_K1876MS_ScDist_P.png
```{r}
newdf <- ErosionControlDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
title <- paste("Distribution of final score on ", scene1, "; ", k1, "; ", AccNum, sep="")
xlab <- "Score"
fileName_P <- file.path(direct, paste("Res_", scene1, "_", k1, "_ScDist_P", sep=""))

ggplot(df, aes(x=Score,y=((..count..)/sum(..count..)))) +
  geom_bar(stat = "count", col="pink", fill="pink", alpha = .8) +
  geom_text(aes(y = ((..count..)/sum(..count..)), label = paste(as.character(scales::percent((..count..)/sum(..count..))), " (", (..count..), ")", sep="")), 
            stat = "count", position = position_dodge(0.9), vjust = -0.5, size=geom.text.size) + 
  ggtitle(title) + xlab(xlab) + ylab("percentage") + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(angle=30, hjust=1, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
savefig(fileName_P, 300, 10, 8, "in", "both")
```

## Figure 24. The frequency of 20 most commonly submitted answers in ErosionControl item (considering type of barriers). The bars within the green rectangles show the different possible correct answers (i.e., Controlled Position). The bars within the red rectangles show the most common mistake that students made (i.e., Varied All Positions).
Res_ErosionControl_K1876MS_DragFreq.png
```{r}
range <- 1:20
newdf <- ErosionControlDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]

fileName_CSV <- file.path(direct, paste("Res_", scene1, "_", k1, "_DragFreq.csv", sep=""))
title <- paste("Frequency of Answer Positions (All Students): ", scene1, "; ", k1, "; ", AccNum, sep="")
xlabel <- "Answer Position"
fileName_Bar <- file.path(direct, paste("Res_", scene1, "_", k1, "_DragFreq_Bar", sep=""))
fileName_Bar_P <- file.path(direct, paste("Res_", scene1, "_", k1, "_DragFreq_Bar_P", sep=""))
getClickDragAnsFreq('order', newdf, 'FinAns', fileName_CSV, range, title, xlabel, fileName_Bar, fileName_Bar_P, TRUE, 70)
```

## Figure 25. The frequency of 20 most commonly submitted answers in ErosionControl item (not considering type of barriers). The bars within the green rectangles show the different possible correct answers (i.e., Controlled Position). The bars within the red rectangles show the most common mistake that students made (i.e., Varied All Positions).

Res_ErosionControl_K1876MS_FinDragFreq.png
```{r}
fileName_CSV <- file.path(direct, paste("Res_", scene1, "_", k1, "_FinDragFreq.csv", sep=""))
title <- paste("Frequency of Final Answer Positions (All Students): ", scene1, "; ", k1, "; ", AccNum, sep="")
xlabel <- "Final Answer Position"
fileName_Bar <- file.path(direct, paste("Res_", scene1, "_", k1, "_FinDragFreq_Bar", sep=""))
fileName_Bar_P <- file.path(direct, paste("Res_", scene1, "_", k1, "_FinDragFreq_Bar_P", sep=""))
getClickDragAnsFreq('order', newdf, 'FinAnsPos', fileName_CSV, range, title, xlabel, fileName_Bar, fileName_Bar_P, FALSE, 45)
```

## Figure 26. The duration of students in ErosionControl scene grouped by the scores.
Res_ErosionControl_K1876MS_SceneDur.png
```{r}
# draw scene duration boxplot
newdf <- ErosionControlDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
x <- 'Score'; y <- 'SceneDur'; xlab <- 'Score'; ylab <- 'Scene Duration (s)'
title <- paste('Scene Duration in ', scene1, '; ', k1, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_SceneDur", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 27. Students' number of drag-and-drop actions grouped by their scores.
Res_ErosionControl_K1876MS_NoDragDist.png
```{r}
newdf$Score <- factor(newdf$Score)
ggplot(newdf, aes(x=NoDrag, color=Score)) + geom_density(aes(group=Score, colour=Score, fill=Score), alpha=.1, size=2) +
  xlim(c(0,20)) + labs(x = "No Drags", y = "Density", size = geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(angle=0, hjust=0.5, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_NoDragDist", sep=""))
savefig(fileName, 300, 15, 8, "in", "both")
```

## Figure 29. Percentage of students in each scoring group in SampleData scene.
Res_SampleData_K187302_ScDist_P.png
```{r}
newdf <- SampleDataDFa; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
title <- paste("Distribution of final score on ", scene4, "; ", k4a, "; ", AccNum, sep="")
xlab <- "Score"
fileName <- file.path(direct, paste("Res_", scene4, "_", k4a, "_ScDist", sep=""))
fileName_P <- file.path(direct, paste("Res_", scene4, "_", k4a, "_ScDist_P", sep=""))
drawScoreDist(newdf, title, xlab, fileName, fileName_P)
```

## Figure 30. A comparison of students' performance in SampleData scene (K187302; knowing how to do a fair test) and ErosionControl scene (K1876MS; doing fair test)
Res_ErosionControl_K1876MS_SampleData_K187302_CrossType_P.png
```{r}
#	What is the correlation between ErosionControl-K1876MS and SampleData-K187302 scores? (A scatterplot)  
df <- SampleDataDFa[, c("BookletNumber", "Score")]; if(!keepNA) df <- df[!is.na(df$Score), ]
names(df) <- c("BookletNumber", "Score_K187302")
df <- merge(df, ErosionControlDF[,c("BookletNumber", "Score")], by="BookletNumber", all.x=TRUE)
names(df) <- c("BookletNumber", "Score_K187302", "Score_K1876MS")
df <- df[!is.na(df$Score_K187302) & !is.na(df$Score_K1876MS), ]

df$AnsG <- NA
df[(df$Score_K187302==1) & (df$Score_K1876MS==3), 'AnsG'] <- "Wrong K187302\nCorrect K1876MS"
df[(df$Score_K187302==2) & (df$Score_K1876MS!=3), 'AnsG'] <- "Correct K187302\nWrong K1876MS"
df[(df$Score_K187302==1) & (df$Score_K1876MS!=3), 'AnsG'] <- "Wrong K187302\nWrong K1876MS"
df[(df$Score_K187302==2) & (df$Score_K1876MS==3), 'AnsG'] <- "Correct K187302\nCorrect K1876MS"
fileName <- file.path(direct, paste('Res_', scene1, '_', k1, '_', scene4, '_', k4a, '_CrossType.csv', sep=""))
# write.csv(df, fileName, row.names = FALSE)

w_c <- nrow(df[(df$Score_K187302==1) & (df$Score_K1876MS==3), ]) # 161 # wrong in K187302 but correct in K1876MS
c_w <- nrow(df[(df$Score_K187302==2) & (df$Score_K1876MS!=3), ]) # 641
w_w <- nrow(df[(df$Score_K187302==1) & (df$Score_K1876MS!=3), ]) # 492
c_c <- nrow(df[(df$Score_K187302==2) & (df$Score_K1876MS==3), ]) # 312 # correct in K187302 and correct in K1876MS
rate_w_c <- w_c/nrow(df); rate_c_w <- c_w/nrow(df)
rate_w_w <- w_w/nrow(df); rate_c_c <- c_c/nrow(df)
dat <- data.frame(type=c("Wrong K187302\nCorrect K1876MS", "Correct K187302\nWrong K1876MS",
                         "Wrong K187302\nWrong K1876MS", "Correct K187302\nCorrect K1876MS"), 
                  num=c(w_c, c_w, w_w, c_c), ratio=c(rate_w_c, rate_c_w, rate_w_w, rate_c_c))

ggplot(data=dat, aes(x=type, y=ratio)) +
  geom_bar(position=position_dodge(), fill="pink", stat="identity") +
  geom_text(aes(x=type, y=ratio, label=paste(format(round(100*ratio,nsmall),nsmall=nsmall), "% (", num, ")", sep="")), vjust=-0.5, hjust=0.5, size=geom.text.size) + 
  ggtitle(paste("Students Performance\n", scene1, " vs. ", scene4, "; ", k1, " vs. ", k4a, "; ", AccNum, sep="")) + 
  labs(x="Groups", y="Percentage of Students", size=geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(hjust=0.5, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_", scene4, "_", k4a, "_CrossType_P", sep=""))
savefig(fileName, 300, 10, 8, "in", "both")
```

## Figure 31. Students' performance in SampleData scene grouped by their strategies (scores) in ErosionControl scene.
Fig. 30 - Res_ErosionControl_K1876MS_SampleData_K187302_CrossScore_P.png
```{r}
# draw scores between ErosionControl and SampleData
df1 <- ErosionControlDF; if(!keepNA) df1 <- df1[!is.na(df1$Score),]
df2 <- SampleDataDFa; if(!keepNA) df2 <- df2[!is.na(df2$Score),]
mergeDF <- merge(df1[,c('BookletNumber', 'Score')], df2[,c('BookletNumber', 'Score')], by='BookletNumber', all.x=TRUE)
names(mergeDF) <- c('BookletNumber', paste('Score_', k1, sep=""), paste('Score_', k4a, sep=""))
if(!keepNA) mergeDF <- mergeDF[!is.na(mergeDF$Score_K1876MS) & !is.na(mergeDF$Score_K187302), ]
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_", scene4, "_", k4a, "_CrossScore.csv", sep=""))
# write.csv(mergeDF, fileName, row.names = FALSE)

countG <- c(); ratG <- c()
for(sc1 in min(mergeDF$Score_K1876MS):max(mergeDF$Score_K1876MS)){
  for(sc2 in min(mergeDF$Score_K187302):max(mergeDF$Score_K187302)){
    countG <- c(countG, nrow(mergeDF[mergeDF$Score_K1876MS==sc1 & mergeDF$Score_K187302==sc2, ]))
    ratG <- c(ratG, nrow(mergeDF[mergeDF$Score_K1876MS==sc1 & mergeDF$Score_K187302==sc2, ])/nrow(mergeDF[mergeDF$Score_K1876MS==sc1, ]))
  }
}

# draw figure
sc1val <- c(1, 1, 2, 2, 3, 3); sc2val <- c(1, 2, 1, 2, 1, 2) 
dat <- data.frame(sc1val=sc1val, sc2val=sc2val, countG=countG, ratG=ratG)
sc1label <- c('Varited all Positions(1)', 'Partial Controlled Positions(2)', 'Controlled Position\n(Correct Fair Test)(3)')
sc2label <- c('Incorrect(1)', 'Correct(2)')
dat$sc1val <- factor(dat$sc1val, levels=c(1,2,3), labels=sc1label)
dat$sc2val <- factor(dat$sc2val, levels=c(1,2), labels=sc2label)

ggplot(data=dat, aes(x=sc1val, y=ratG, fill=sc2val)) +
  geom_col() +
  geom_text(aes(label=paste(format(round(dat$ratG*100,nsmall), nsmall=nsmall), ' % (', countG, ')', sep=""), vjust=.5, size=geom.text.size), position=position_stack(vjust=.5), size=geom.text.size) + 
  ggtitle(paste("Distributions of Group (in ", scene4, ") in ", scene1, sep="")) + 
  labs(x="ErosionControl", y="Percentage", size=geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(angle=-30, hjust=0, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_", scene4, "_", k4a, "_CrossScore_P", sep=""))
savefig(fileName, 300, 15, 8, "in", "both")
```

## Figure 33. Percentage of students in each scoring group in ControlVariable scene.
Res_ControlVariable_K1877MS_ScDist_P.png
```{r}
newdf <- ControlVariableDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
title <- paste("Distribution of final score on ", scene2, "; ", k2, "; ", AccNum, sep="")
xlab <- "Score"
fileName <- file.path(direct, paste("Res_", scene2, "_", k2, "_ScDist", sep=""))
fileName_P <- file.path(direct, paste("Res_", scene2, "_", k2, "_ScDist_P", sep=""))
drawScoreDist(newdf, title, xlab, fileName, fileName_P)
```

## Figure 34. A comparison of students' performance in ControlVariable scene (K1877MS; knowing how to do a fair test) and ErosionControl scene (K1876MS; doing fair test)

Res_ErosionControl_K1876MS_ControlVariable_K1877MS_CrossType_P.png
```{r}
#	What is the correlation between ErosionControl-K1876MS and ControlVariable- K1877MS scores? (A scatterplot)  
df <- ControlVariableDF[, c("BookletNumber", "Score")]; if(!keepNA) df <- df[!is.na(df$Score), ]
names(df) <- c("BookletNumber", "Score_K1877MS")
df <- merge(df, ErosionControlDF[,c("BookletNumber", "Score")], by="BookletNumber", all.x=TRUE)
names(df) <- c("BookletNumber", "Score_K1877MS", "Score_K1876MS")
df <- df[!is.na(df$Score_K1877MS) & !is.na(df$Score_K1876MS), ]

df$AnsG <- NA
df[(df$Score_K1877MS==1) & (df$Score_K1876MS==3), 'AnsG'] <- "Wrong K1877MS\nCorrect K1876MS"
df[(df$Score_K1877MS==2) & (df$Score_K1876MS!=3), 'AnsG'] <- "Correct K1877MS\nWrong K1876MS"
df[(df$Score_K1877MS==1) & (df$Score_K1876MS!=3), 'AnsG'] <- "Wrong K1877MS\nWrong K1876MS"
df[(df$Score_K1877MS==2) & (df$Score_K1876MS==3), 'AnsG'] <- "Correct K1877MS\nCorrect K1876MS"
fileName <- file.path(direct, paste('Res_', scene1, '_', k1, '_', scene2, '_', k2, '_CrossType.csv', sep=""))
# write.csv(df, fileName, row.names = FALSE)

w_c <- nrow(df[(df$Score_K1877MS==1) & (df$Score_K1876MS==3), ]) # 133 # wrong in K1877MS but correct in K1876MS
c_w <- nrow(df[(df$Score_K1877MS==2) & (df$Score_K1876MS!=3), ]) # 551
w_w <- nrow(df[(df$Score_K1877MS==1) & (df$Score_K1876MS!=3), ]) # 581
c_c <- nrow(df[(df$Score_K1877MS==2) & (df$Score_K1876MS==3), ]) # 340 # correct in K1877MS and correct in K1876MS
rate_w_c <- w_c/nrow(df); rate_c_w <- c_w/nrow(df)
rate_w_w <- w_w/nrow(df); rate_c_c <- c_c/nrow(df)
dat <- data.frame(type=c("Wrong K1877MS\nCorrect K1876MS", "Correct K1877MS\nWrong K1876MS",
                         "Wrong K1877MS\nWrong K1876MS", "Correct K1877MS\nCorrect K1876MS"), 
                  num=c(w_c, c_w, w_w, c_c), ratio=c(rate_w_c, rate_c_w, rate_w_w, rate_c_c))

ggplot(data=dat, aes(x=type, y=ratio)) +
  geom_bar(position=position_dodge(), fill="pink", stat="identity") +
  geom_text(aes(x=type, y=ratio, label=paste(format(round(100*ratio,nsmall),nsmall=nsmall), "% (", num, ")", sep="")), vjust=-0.5, hjust=0.5, size=geom.text.size) + 
  ggtitle(paste("Students Performance\n", scene1, " vs. ", scene2, "; ", k1, " vs. ", k2, "; ", AccNum, sep="")) + 
  labs(x="Groups", y="Percentage of Students", size=geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(hjust=0.5, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_", scene2, "_", k2, "_CrossType_P", sep=""))
savefig(fileName, 300, 10, 8, "in", "both")
```

## Figure 35. Students' performance in ControlVariable scene grouped by their strategies (scores) in ErosionControl scene.

Res_ErosionControl_K1876MS_ControlVariable_K1877MS_CrossScore_P.png
```{r}
# draw scores between ErosionControl and ControlVariable
df1 <- ErosionControlDF; if(!keepNA) df1 <- df1[!is.na(df1$Score),]
df2 <- ControlVariableDF; if(!keepNA) df2 <- df2[!is.na(df2$Score),]
mergeDF <- merge(df1[,c('BookletNumber', 'Score')], df2[,c('BookletNumber', 'Score')], by='BookletNumber', all.x=TRUE)
names(mergeDF) <- c('BookletNumber', paste('Score_', k1, sep=""), paste('Score_', k2, sep=""))
if(!keepNA) mergeDF <- mergeDF[!is.na(mergeDF$Score_K1876MS) & !is.na(mergeDF$Score_K1877MS), ]
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_", scene2, "_", k2, "_CrossScore.csv", sep=""))
# write.csv(mergeDF, fileName, row.names = FALSE)

countG <- c(); ratG <- c()
for(sc1 in min(mergeDF$Score_K1876MS):max(mergeDF$Score_K1876MS)){
  for(sc2 in min(mergeDF$Score_K1877MS):max(mergeDF$Score_K1877MS)){
    countG <- c(countG, nrow(mergeDF[mergeDF$Score_K1876MS==sc1 & mergeDF$Score_K1877MS==sc2, ]))
    ratG <- c(ratG, nrow(mergeDF[mergeDF$Score_K1876MS==sc1 & mergeDF$Score_K1877MS==sc2, ])/nrow(mergeDF[mergeDF$Score_K1876MS==sc1, ]))
  }
}

# draw figure
sc1val <- c(1, 1, 2, 2, 3, 3); sc2val <- c(1, 2, 1, 2, 1, 2) 
dat <- data.frame(sc1val=sc1val, sc2val=sc2val, countG=countG, ratG=ratG)
sc1label <- c('Varited all Positions(1)', 'Partial Controlled Positions(2)', 'Controlled Position\n(Correct Fair Test)(3)')
sc2label <- c('Incorrect(1)', 'Correct(2)')
dat$sc1val <- factor(dat$sc1val, levels=c(1,2,3), labels=sc1label)
dat$sc2val <- factor(dat$sc2val, levels=c(1,2), labels=sc2label)

ggplot(data=dat, aes(x=sc1val, y=ratG, fill=sc2val)) +
  geom_col() +
  geom_text(aes(label=paste(format(round(dat$ratG*100,nsmall), nsmall=nsmall), ' % (', countG, ')', sep=""), vjust=.5, size=geom.text.size), position=position_stack(vjust=.5), size=geom.text.size) + 
  ggtitle(paste("Distributions of Group (in ", scene2, ") in ", scene1, sep="")) + 
  labs(x="ErosionControl", y="Percentage", size=geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(angle=-30, hjust=0, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene1, "_", k1, "_", scene2, "_", k2, "_CrossScore_P", sep=""))
savefig(fileName, 300, 15, 8, "in", "both")
```

# Other Scene-specific Results

## Figure 78. Percentage of students in scoring group in Introduction scene.
Res_Introduction_K1871MS_ScDist_P.png
```{r}
# draw score distribution
newdf <- IntroductionDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
title <- paste("Distribution of Score on ", scene7, "; ", k7, "; ", AccNum, sep="")
xlab <- "Score"
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_ScDist", sep=""))
fileName_P <- file.path(direct, paste("Res_", scene7, "_", k7, "_ScDist_P", sep=""))
drawScoreDist(newdf, title, xlab, fileName, fileName_P)
```
## Figure 79. The relation with the time spent on Introduction scene and students' scores.
Res_Introduction_K1871MS_SceneDur.png
```{r}
# draw scene duration boxplot
newdf <- IntroductionDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
x <- 'Score'; y <- 'SceneDur'; xlab <- 'Score'; ylab <- 'Scene Duration (s)'
title <- paste('Scene Duration in ', scene7, '; ', k7, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_SceneDur", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 80. Percentage of submitted values and number of trials in Introduction scene.
Res_Introduction_K1871MS_SubmitVal_Bar_P.png
```{r}
# all students' submitted values
newdf <- IntroductionDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
newdf$SubmitText <- "" # store submitetd answers ignoring the order of submission
for(i in 1:nrow(newdf)){
  if(as.character(newdf$FinAnsText[i])!='' & as.character(newdf$FinAnsText[i])!='0.0'){
    curans <- unlist(strsplit(as.character(newdf$FinAnsText[i]), "; "))
    newcurans <- c()
    for(j in 1:length(curans)){
      newcurans <- c(newcurans, paste(unlist(strsplit(curans[j], "-"))[2], " m", sep="")) 
    }
    newdf$SubmitText[i] <- paste(newcurans, collapse = "; ")
  }
}
range <- 1:20
fileName_CSV <- file.path(direct, paste("Res_", scene7, "_", k7, "_SubmitVal.csv", sep=""))
title <- paste("Percentage of Submitted Values: ", scene7, "; ", k7, "; ", AccNum, sep="")
xlabel <- "Submitted Values"
fileName_Bar <- file.path(direct, paste("Res_", scene7, "_", k7, "_SubmitVal_Bar", sep=""))
fileName_Bar_P <- file.path(direct, paste("Res_", scene7, "_", k7, "_SubmitVal_Bar_P", sep=""))
getClickDragAnsFreq('noorder', newdf, 'SubmitText', fileName_CSV, range, title, xlabel, fileName_Bar, fileName_Bar_P, FALSE, 45)
```

## Figure 81. Density of submitted values in Introduction scene.
Res_Introduction_K1871MS_SubmitValDist.png
```{r}
#	What is the most common wrong submitted answer in meters and the frequency of the submitted answers?
# frequency of submitted answers
newdf <- IntroductionDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
subAns <- c()
for(i in 1:nrow(newdf)){
  if(!is.na(newdf$FinAnsText[i])){
    finans <- unlist(strsplit(as.character(newdf$FinAnsText[i]), "; "))
    for(j in 1:length(finans)){
      subAns <- c(subAns, as.numeric(unlist(strsplit(finans[j], "-"))[2]))
    }
  }
}
subAnsDF <- data.frame(x=subAns)
# draw density
ggplot(subAnsDF, aes(x=x)) + geom_density(alpha=.1, size=2) +
  xlim(c(0,8)) + labs(x = "Submitted Values", y = "Density", size = geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(angle=0, hjust=0.5, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_SubmitValDist", sep=""))
savefig(fileName, 300, 15, 8, "in", "both")
```

## Figure 82. Average number of submitted trials grouped by scores in Introduction scene.
Res_Introduction_K1871MS_NoSubmitAnsDist_violin.png
```{r}
# draw violin figure for no. submitted answers
newdf <- IntroductionDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
newdf$NoSubmit <- NA
for(i in 1:nrow(newdf)){
  newdf$NoSubmit[i] <- length(unlist(strsplit(as.character(newdf$FinAnsText[i]), "; ")))
}
x <- 'Score'; y <- 'NoSubmit'; xlab <- 'Score'; ylab <- 'No. Submitted Answers'
title <- paste('No. Submitted Answers in ', scene7, '; ', k7, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_NoSubmitAnsDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 83. Average number of add row clicks grouped by scores in Introduction scene.
Res_Introduction_K1871MS_NoAddRowAvgDist_violin.png
```{r}
# box and violin plot
newdf <- IntroductionDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
newdf$Score <- factor(newdf$Score)
newdf$NoSubmit <- NA
for(i in 1:nrow(newdf)){
  newdf$NoSubmit[i] <- length(unlist(strsplit(as.character(newdf$FinAnsText[i]), "; ")))
}
newdf$NoButtonClick <- newdf$NoAddRow + newdf$NoDelRow
newdf$NoButtonClick_avg <- newdf$NoButtonClick/newdf$NoSubmit
newdf$NoAddRow_avg <- newdf$NoAddRow/newdf$NoSubmit
newdf$NoDelRow_avg <- newdf$NoDelRow/newdf$NoSubmit

x <- 'Score'; y <- 'NoAddRow_avg'; xlab <- 'Score'; ylab <- 'No. AddRow (avg)'
title <- paste('No. AddRow (avg) in ', scene7, '; ', k7, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_NoAddRowAvgDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 84. Average number of raise and lower button clicks grouped by scores in Introduction scene.
Res_Introduction_K1871MS_NoButtonClickAvgDist_violin.png
```{r}
x <- 'Score'; y <- 'NoButtonClick_avg'; xlab <- 'Score'; ylab <- 'No. Button Clicks (avg)'
title <- paste('No. Button Clicks (avg) in ', scene7, '; ', k7, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_NoButtonClickAvgDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 85. Average number of delete row clicks grouped by scores in Introduction scene.
Res_Introduction_K1871MS_NoDelRowAvgDist_violin.png
```{r}
x <- 'Score'; y <- 'NoDelRow_avg'; xlab <- 'Score'; ylab <- 'No. DelRow (avg)'
title <- paste('No. DelRow (avg) in ', scene7, '; ', k7, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene7, "_", k7, "_NoDelRowAvgDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 87. Percentage of students in each score.
Res_LocationXDepth_K1872MS_ScDist_P.png
```{r}
# draw score distribution
newdf <- LocationXDepthDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
title <- paste("Distribution of Score on ", scene8, "; ", k8, "; ", AccNum, sep="")
xlab <- "Score"
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_ScDist", sep=""))
fileName_P <- file.path(direct, paste("Res_", scene8, "_", k8, "_ScDist_P", sep=""))
drawScoreDist(newdf, title, xlab, fileName, fileName_P)
```
## Figure 88. The relation with the time spent on LocationXDepth scene and students' scores.
Res_LocationXDepth_K1872MS_SceneDur.png

```{r}
# draw scene duration boxplot
newdf <- LocationXDepthDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
x <- 'Score'; y <- 'SceneDur'; xlab <- 'Score'; ylab <- 'Scene Duration (s)'
title <- paste('Scene Duration in ', scene8, '; ', k8, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_SceneDur", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 89. Percentage of submitted values in LocationXDepth scene.
Res_LocationXDepth_K1872MS_SubmitVal_Bar_P.png
```{r}
# all students' submitted values
newdf <- LocationXDepthDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score), ]
newdf$SubmitText <- "" # store submitetd answers ignoring the order of submission
for(i in 1:nrow(newdf)){
  if(as.character(newdf$FinAnsText[i])!='' & as.character(newdf$FinAnsText[i])!='0.0'){
    curans <- unlist(strsplit(as.character(newdf$FinAnsText[i]), "; "))
    newcurans <- c()
    for(j in 1:length(curans)){
      newcurans <- c(newcurans, paste(unlist(strsplit(curans[j], "-"))[2], " m", sep="")) 
    }
    newdf$SubmitText[i] <- paste(newcurans, collapse = "; ")
  }
}
range <- 1:20
fileName_CSV <- file.path(direct, paste("Res_", scene8, "_", k8, "_SubmitVal.csv", sep=""))
title <- paste("Percentage of Submitted Values: ", scene8, "; ", k8, "; ", AccNum, sep="")
xlabel <- "Submitted Values"
fileName_Bar <- file.path(direct, paste("Res_", scene8, "_", k8, "_SubmitVal_Bar", sep=""))
fileName_Bar_P <- file.path(direct, paste("Res_", scene8, "_", k8, "_SubmitVal_Bar_P", sep=""))
getClickDragAnsFreq('noorder', newdf, 'SubmitText', fileName_CSV, range, title, xlabel, fileName_Bar, fileName_Bar_P, FALSE, 45)
```

## Figure 90. The density of submitted values in LocationXDepth scene.
Res_LocationXDepth_K1872MS_SubmitValDist.png
```{r}
#	What is the most common wrong submitted answer in meters and the frequency of the submitted answers?
# frequency of submitted answers
newdf <- LocationXDepthDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
subAns <- c()
for(i in 1:nrow(newdf)){
  if(!is.na(newdf$FinAnsText[i])){
    finans <- unlist(strsplit(as.character(newdf$FinAnsText[i]), "; "))
    for(j in 1:length(finans)){
      subAns <- c(subAns, as.numeric(unlist(strsplit(finans[j], "-"))[2]))
    }
  }
}
subAnsDF <- data.frame(x=subAns)
# draw density
ggplot(subAnsDF, aes(x=x)) + geom_density(alpha=.1, size=2) +
  xlim(c(0,8)) + labs(x = "Submitted Values", y = "Density", size = geom.text.size) + 
  theme_bw() + 
  theme(plot.title=element_text(size=theme.size), 
        axis.title=element_text(size=theme.size, face="bold"), 
        axis.text.x=element_text(angle=0, hjust=0.5, size=theme.size), axis.text.y=element_text(size=theme.size),
        panel.grid.major=element_line(colour="grey", linetype="dotted", size=1))
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_SubmitValDist", sep=""))
savefig(fileName, 300, 15, 8, "in", "both")
```

## Figure 91. Average number of submitted trials grouped by scores in LocationXDepth scene.
Res_LocationXDepth_K1872MS_NoSubmitDist_box.png

*This one is labeled as above in the report. However, no such file is generated in Tao's code. Going by the caption for Figure 91, I believe it should be referring to the following:

Res_LocationXDepth_K1872MS_NoSubmitAnsDist_violin.png
```{r}
# box and violin plot
newdf <- LocationXDepthDF; if(!keepNA) newdf <- newdf[!is.na(newdf$Score),]
newdf$Score <- factor(newdf$Score)
newdf$NoSubmit <- NA
for(i in 1:nrow(newdf)){
  newdf$NoSubmit[i] <- length(unlist(strsplit(as.character(newdf$FinAnsText[i]), "; ")))
}
newdf$NoButtonClick <- newdf$NoAddRow + newdf$NoDelRow
newdf$NoButtonClick_avg <- newdf$NoButtonClick/newdf$NoSubmit
newdf$NoAddRow_avg <- newdf$NoAddRow/newdf$NoSubmit
newdf$NoDelRow_avg <- newdf$NoDelRow/newdf$NoSubmit

x <- 'Score'; y <- 'NoSubmit'; xlab <- 'Score'; ylab <- 'No. Submitted Answers'
title <- paste('No. Submitted Answers in ', scene8, '; ', k8, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_NoSubmitAnsDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 92. Average number of add row clicks grouped by scores in LocationXDepth scene.
Res_LocationXDepth_K1872MS_NoAddRowAvgDist_violin.png
```{r}
x <- 'Score'; y <- 'NoAddRow_avg'; xlab <- 'Score'; ylab <- 'No. AddRow (avg)'
title <- paste('No. AddRow (avg) in ', scene8, '; ', k8, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_NoAddRowAvgDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 93. Average number of raise and lower button clicks grouped by scores in LocationXDepth scene.
Res_LocationXDepth_K1872MS_NoButtonClickAvgDist_violin.png
```{r}
x <- 'Score'; y <- 'NoButtonClick_avg'; xlab <- 'Score'; ylab <- 'No. Button Clicks (avg)'
title <- paste('No. Button Clicks (avg) in ', scene8, '; ', k8, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_NoButtonClickAvgDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```

## Figure 94. Average number of delete row clicks grouped by scores in LocationXDepth scene.
Res_LocationXDepth_K1872MS_NoDelRowAvgDist_violin.png
```{r}
x <- 'Score'; y <- 'NoDelRow_avg'; xlab <- 'Score'; ylab <- 'No. DelRow (avg)'
title <- paste('No. DelRow (avg) in ', scene8, '; ', k8, '; ', AccNum, sep="")
fileName <- file.path(direct, paste("Res_", scene8, "_", k8, "_NoDelRowAvgDist_violin", sep=""))
drawViolin(newdf, x, y, title, xlab, ylab, fileName, TRUE, NA, FALSE, 0)
```